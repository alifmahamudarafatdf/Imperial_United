<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oxford Mission High School</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#1877F2',
                        'primary-dark': '#166FE5',
                        'primary-light': '#E7F3FF',
                        'secondary': '#42B72A',
                        'secondary-dark': '#36A420',
                        'gray-fb': '#F0F2F5',
                        'gray-dark': '#65676B',
                        'card': '#FFFFFF',
                        'admin-gold': '#FFD700'
                    },
                    animation: {
                        'slide-down': 'slideDown 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'bounce-in': 'bounceIn 0.5s ease-out',
                        'success-popup': 'successPopup 2s ease-in-out',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        slideDown: {
                            '0%': { transform: 'translateY(-20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        successPopup: {
                            '0%': { transform: 'translateX(-50%) translateY(100px)', opacity: '0' },
                            '15%': { transform: 'translateX(-50%) translateY(0)', opacity: '1' },
                            '85%': { transform: 'translateX(-50%) translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateX(-50%) translateY(100px)', opacity: '0' }
                        }
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'gradient-blue': 'linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%)',
                        'gradient-facebook': 'linear-gradient(135deg, #1877F2 0%, #166FE5 100%)',
                        'gradient-green': 'linear-gradient(135deg, #42B72A 0%, #36A420 100%)',
                        'gradient-card': 'linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)',
                        'gradient-gold': 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)'
                    }
                }
            }
        }
    </script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .shadow-soft {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .shadow-deep {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            transition: transform 0.3s ease;
        }
        
        .profile-border {
            border: 4px solid #E7F3FF;
            border-radius: 50%;
            padding: 2px;
        }
        
        .admin-border {
            border: 4px solid #FFD700;
            border-radius: 50%;
            padding: 2px;
        }
        
        .post-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .admin-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #1F2937;
            font-weight: 700;
            letter-spacing: 0.5px;
            padding: 8px 16px;
        }
        
        .like-btn:active {
            transform: scale(1.3);
            transition: transform 0.1s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            animation: bounceIn 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* Success Popup */
        .success-popup {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #42B72A, #36A420);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(66, 183, 42, 0.3);
            animation: successPopup 2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 1000;
            padding: 12px 0;
            display: none;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #E7F3FF;
            color: #1877F2;
        }
        
        @media (max-width: 768px) {
            .mobile-nav {
                display: flex;
                justify-content: space-around;
            }
            
            .desktop-nav {
                display: none;
            }
            
            /* Hide top navigation completely on mobile */
            nav {
                display: none !important;
            }
            
            .modal-content {
                margin: 2% auto;
                max-height: 96vh;
                width: 95%;
            }
            
            /* Adjust content padding for mobile */
            main {
                padding-bottom: 80px !important;
            }
        }
        
        /* Loading animation */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1877F2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Follow/Following button styles */
        .follow-btn {
            transition: all 0.3s ease;
        }
        
        .follow-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Like animation */
        @keyframes likeAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .like-animation {
            animation: likeAnimation 0.3s ease;
        }
        
        /* Admin Login Button */
        .admin-login-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #1F2937;
            font-weight: 600;
        }
        
        .admin-login-btn:hover {
            background: linear-gradient(45deg, #FFA500, #FF8C00);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }
        
        /* Class update highlight */
        .class-update {
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            color: #1565c0;
        }
        
        /* School Year Calendar */
        .school-year {
            background: linear-gradient(45deg, #4caf50, #2e7d32);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        /* Password strength indicator */
        .password-strength {
            height: 4px;
            border-radius: 2px;
            margin-top: 5px;
            transition: all 0.3s ease;
        }
        
        .strength-weak { background-color: #EF4444; width: 25%; }
        .strength-fair { background-color: #F59E0B; width: 50%; }
        .strength-good { background-color: #10B981; width: 75%; }
        .strength-strong { background-color: #10B981; width: 100%; }
        
        /* Error message */
        .error-message {
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-fb min-h-screen">
    <!-- Success Popup Container -->
    <div id="success-popup-container"></div>

    <!-- Top Bar -->
    <div class="bg-gradient-blue text-white py-2 px-4 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center text-sm">
            <div class="flex flex-wrap justify-center gap-4 mb-2 md:mb-0">
                <span class="flex items-center gap-2"><i class="fas fa-envelope"></i>oxfordmissionhighschoolb@gmail.com</span>
                <span class="flex items-center gap-2"><i class="fas fa-phone"></i>+880 1234 567890</span>
            </div>
            <div class="flex items-center space-x-4">
                <div id="user-display" class="flex items-center"></div>
                <div id="admin-login-btn-container">
                    <button onclick="showAdminLoginModal()" 
                            class="admin-login-btn px-5 py-2 rounded-lg font-semibold transition-all duration-300 shadow-sm hover:shadow-md mr-2">
                        <i class="fas fa-crown mr-2"></i>Admin Login
                    </button>
                </div>
                <button id="login-btn" onclick="showModal('login-modal')" 
                        class="bg-white text-primary px-5 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-all duration-300 shadow-sm hover:shadow-md">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </div>
        </div>
    </div>

    <!-- Desktop Navigation (Hidden on Mobile) -->
    <nav class="bg-white shadow-sm sticky top-0 z-50 hidden md:block">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center py-4">
                <!-- School Logo and Name -->
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="w-14 h-14 rounded-full bg-gradient-primary flex items-center justify-center mr-3 shadow-md">
                        <i class="fas fa-graduation-cap text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Oxford Mission High School</h1>
                        <p class="text-gray-dark text-sm">Excellence in Education Since 1995</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="desktop-nav flex flex-wrap justify-center gap-4 md:gap-8">
                    <a href="#home" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">HOME</a>
                    <a href="#about" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">ABOUT US</a>
                    <a href="#academic" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">ACADEMIC</a>
                    <a href="#information" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">INFORMATION</a>
                    <a href="#admission" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">ADMISSION</a>
                    <a href="#gallery" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">GALLERY</a>
                    <a href="#notice" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">NOTICE</a>
                    <a href="#contact" class="nav-link text-gray-dark font-medium hover:text-primary transition-all duration-300 relative after:absolute after:bottom-[-5px] after:left-0 after:w-0 after:h-1 after:bg-primary after:transition-all after:duration-300 hover:after:w-full">CONTACT</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <a href="#home" class="nav-item text-gray-dark" onclick="scrollToSection('home')">
            <i class="fas fa-home text-lg"></i>
            <span class="text-xs mt-1">Home</span>
        </a>
        <a href="#community" class="nav-item text-gray-dark" onclick="scrollToSection('community')">
            <i class="fas fa-users text-lg"></i>
            <span class="text-xs mt-1">Community</span>
        </a>
        <a href="#notice" class="nav-item text-gray-dark" onclick="scrollToSection('notice')">
            <i class="fas fa-bullhorn text-lg"></i>
            <span class="text-xs mt-1">Notice</span>
        </a>
        <button onclick="openProfileModal()" class="nav-item text-gray-dark">
            <i class="fas fa-user text-lg"></i>
            <span class="text-xs mt-1">Profile</span>
        </button>
        <button onclick="showModal('login-modal')" id="mobile-login-btn" class="nav-item text-primary">
            <i class="fas fa-sign-in-alt text-lg"></i>
            <span class="text-xs mt-1">Login</span>
        </button>
    </div>

    <!-- Hero Section -->
    <section id="home" class="relative h-96 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/80 to-primary-dark/80 z-10"></div>
        <div class="absolute inset-0 bg-gray-300 flex items-center justify-center z-0">
            <div class="text-center">
                <i class="fas fa-school text-gray-400 text-9xl mb-4"></i>
                <div class="text-4xl font-bold text-white animate-pulse-slow">Welcome</div>
            </div>
        </div>
        <div class="relative z-20 h-full flex items-center justify-center text-center text-white px-4">
            <div class="animate-slide-down">
                <h2 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-lg">Welcome to Oxford Mission High School</h2>
                <p class="text-xl mb-8 opacity-90">Excellence in Education Since 1995</p>
                <div class="flex flex-wrap justify-center gap-4">
                    <button class="bg-white text-primary px-8 py-3 rounded-lg font-bold hover:bg-gray-100 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        <i class="fas fa-calendar-check mr-2"></i>Get Appointment
                    </button>
                    <button class="bg-transparent border-2 border-white text-white px-8 py-3 rounded-lg font-bold hover:bg-white/10 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        <i class="fas fa-map-marked-alt mr-2"></i>Take a School Tour
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Search System -->
    <section class="bg-gradient-to-b from-gray-fb to-white py-8">
        <div class="container mx-auto px-4">
            <div class="max-w-2xl mx-auto animate-slide-up">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Find Students</h3>
                    <p class="text-gray-dark">Search by name to connect with fellow students</p>
                </div>
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Search for students by name..." 
                           class="w-full p-4 pl-14 rounded-xl border-2 border-gray-300 focus:border-primary focus:outline-none shadow-soft focus:shadow-deep transition-all duration-300">
                    <i class="fas fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-dark text-lg"></i>
                    <button class="absolute right-4 top-1/2 transform -translate-y-1/2 text-primary">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                </div>
                <div id="search-results" class="mt-4 bg-white rounded-xl shadow-soft max-h-60 overflow-y-auto hidden animate-fade-in"></div>
            </div>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8 pb-24 md:pb-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Left Column - Content -->
            <div class="lg:w-2/3">
                <!-- About Section -->
                <section id="about" class="mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-primary/30">About Our School</h2>
                    <div class="bg-gradient-card rounded-xl shadow-soft p-6 hover-lift">
                        <div class="school-year">Academic Year: 2026-2027</div>
                        <p class="text-gray-700 mb-4">
                            Oxford Mission High School is a premier educational institution committed to academic excellence 
                            and holistic development. Founded in 1995, our school has been nurturing young minds with 
                            quality education and modern teaching methodologies.
                        </p>
                        <p class="text-gray-700 mb-4">
                            We believe in creating an environment where students can explore their potential, develop critical 
                            thinking skills, and become responsible global citizens. Our experienced faculty and state-of-the-art 
                            facilities provide the perfect platform for academic and personal growth.
                        </p>
                        <button class="text-primary font-semibold hover:text-primary-dark transition-all duration-300 flex items-center group">
                            Read More <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform duration-300"></i>
                        </button>
                    </div>
                </section>

                <!-- Community Posts Section -->
                <section id="community" class="mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-primary/30">School Community</h2>
                    
                    <!-- Post Creation (Visible when logged in) -->
                    <div id="post-section" class="hidden mb-8">
                        <div class="bg-gradient-card rounded-xl shadow-soft p-6 mb-6 hover-lift">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Create a Post</h3>
                            <form id="post-form" class="space-y-4">
                                <div>
                                    <textarea id="post-content" placeholder="What's on your mind?" 
                                              class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none resize-none shadow-sm" 
                                              rows="3"></textarea>
                                    <p id="char-count" class="text-right text-sm text-gray-dark mt-1">0/500</p>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex gap-4">
                                        <label for="post-image" class="cursor-pointer text-gray-dark hover:text-primary transition-all duration-300 flex items-center gap-2">
                                            <i class="fas fa-image text-lg"></i>
                                            <span>Photo/Video</span>
                                        </label>
                                    </div>
                                    <div class="text-sm text-gray-dark">
                                        Posts today: <span id="daily-post-count" class="font-bold">0</span>/5
                                    </div>
                                    <button type="submit" id="post-submit" 
                                            class="bg-gradient-facebook text-white px-8 py-2 rounded-lg font-semibold hover:bg-primary-dark transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                                        Post
                                    </button>
                                </div>
                                <div id="image-preview" class="hidden mt-4">
                                    <div class="relative inline-block">
                                        <img id="preview-img" class="max-w-xs rounded-lg shadow-md" />
                                        <button type="button" onclick="removeImage()" 
                                                class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-red-600 transition-all duration-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Posts Feed -->
                    <div id="community-posts" class="space-y-6">
                        <div class="text-center py-12 text-gray-dark">
                            <div class="w-20 h-20 rounded-full bg-primary-light flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-users text-primary text-3xl"></i>
                            </div>
                            <h4 class="text-xl font-semibold mb-2">Welcome to School Community</h4>
                            <p class="mb-6">Login to view and participate in the community</p>
                            <button onclick="showModal('login-modal')" 
                                    class="bg-gradient-facebook text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all duration-300">
                                <i class="fas fa-sign-in-alt mr-2"></i>Login to Continue
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Teachers Section -->
                <section id="teachers" class="mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-primary/30">Our Teachers</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Head Teacher -->
                        <div class="bg-gradient-card rounded-xl shadow-soft p-6 flex items-center hover-lift">
                            <div class="w-24 h-24 rounded-full bg-gradient-primary flex items-center justify-center mr-4 shadow-md">
                                <i class="fas fa-user-tie text-white text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Mr. John Smith</h3>
                                <p class="text-primary font-semibold">Head Teacher</p>
                                <p class="text-gray-dark text-sm mt-1">M.Ed, 25 years of experience</p>
                                <div class="flex gap-2 mt-2">
                                    <span class="text-xs bg-primary-light text-primary px-2 py-1 rounded">Mathematics</span>
                                    <span class="text-xs bg-primary-light text-primary px-2 py-1 rounded">Physics</span>
                                </div>
                            </div>
                        </div>
                        <!-- Senior Teacher -->
                        <div class="bg-gradient-card rounded-xl shadow-soft p-6 flex items-center hover-lift">
                            <div class="w-24 h-24 rounded-full bg-gradient-primary flex items-center justify-center mr-4 shadow-md">
                                <i class="fas fa-chalkboard-teacher text-white text-3xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Mrs. Sarah Johnson</h3>
                                <p class="text-primary font-semibold">Senior Teacher</p>
                                <p class="text-gray-dark text-sm mt-1">M.Sc in Physics, 18 years of experience</p>
                                <div class="flex gap-2 mt-2">
                                    <span class="text-xs bg-primary-light text-primary px-2 py-1 rounded">Physics</span>
                                    <span class="text-xs bg-primary-light text-primary px-2 py-1 rounded">Chemistry</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="other-teachers" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6"></div>
                    <div class="text-center">
                        <button onclick="toggleTeachers()" id="see-more-teachers" 
                                class="bg-gradient-facebook text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all duration-300">
                            <i class="fas fa-plus mr-2"></i>See More Teachers
                        </button>
                    </div>
                </section>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="lg:w-1/3">
                <!-- Notice Board -->
                <section id="notice" class="mb-8">
                    <div class="bg-gradient-card rounded-xl shadow-soft overflow-hidden hover-lift">
                        <div class="bg-gradient-primary text-white p-4">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-bullhorn"></i>
                                Notice Board
                            </h3>
                        </div>
                        <div id="notice-list" class="p-4 space-y-4 max-h-96 overflow-y-auto">
                            <div class="text-center py-8">
                                <div class="loader mx-auto mb-4"></div>
                                <p class="text-gray-dark">Loading notices...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Quick Links -->
                <section class="mb-8">
                    <div class="bg-gradient-card rounded-xl shadow-soft overflow-hidden hover-lift">
                        <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-link"></i>
                                Important Links
                            </h3>
                        </div>
                        <div class="p-4 space-y-2">
                            <a href="#" class="flex items-center text-gray-dark hover:text-primary transition-all duration-300 p-3 hover:bg-primary-light rounded-lg">
                                <i class="fas fa-external-link-alt mr-3 text-primary"></i>
                                Dhaka Education Board
                            </a>
                            <a href="#" class="flex items-center text-gray-dark hover:text-primary transition-all duration-300 p-3 hover:bg-primary-light rounded-lg">
                                <i class="fas fa-external-link-alt mr-3 text-primary"></i>
                                Ministry of Education
                            </a>
                            <a href="#" class="flex items-center text-gray-dark hover:text-primary transition-all duration-300 p-3 hover:bg-primary-light rounded-lg">
                                <i class="fas fa-external-link-alt mr-3 text-primary"></i>
                                Directorate of Secondary Education
                            </a>
                            <a href="#" class="flex items-center text-gray-dark hover:text-primary transition-all duration-300 p-3 hover:bg-primary-light rounded-lg">
                                <i class="fas fa-external-link-alt mr-3 text-primary"></i>
                                eTIF Portal
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Visitor Counter -->
                <section class="mb-8">
                    <div class="bg-gradient-card rounded-xl shadow-soft overflow-hidden hover-lift">
                        <div class="bg-gradient-to-r from-primary to-primary-dark text-white p-4">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-chart-line"></i>
                                Visitor Counter
                            </h3>
                        </div>
                        <div class="p-6 text-center">
                            <div class="text-5xl font-bold text-primary mb-2 animate-pulse-slow" id="visitor-today">0</div>
                            <p class="text-gray-dark">Today's Visitors</p>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="text-3xl font-bold text-gray-800 mb-1" id="visitor-total">0</div>
                                <p class="text-gray-dark">Total Visitors</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Contact Info -->
                <section>
                    <div class="bg-gradient-card rounded-xl shadow-soft overflow-hidden hover-lift">
                        <div class="bg-gradient-green text-white p-4">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-info-circle"></i>
                                Contact Info
                            </h3>
                        </div>
                        <div class="p-4 space-y-3">
                            <div class="flex items-center p-3 hover:bg-primary-light rounded-lg transition-all duration-300">
                                <div class="w-10 h-10 rounded-full bg-primary-light flex items-center justify-center mr-3">
                                    <i class="fas fa-phone text-primary"></i>
                                </div>
                                <span class="text-gray-700">+880 1234 567890</span>
                            </div>
                            <div class="flex items-start p-3 hover:bg-primary-light rounded-lg transition-all duration-300">
                                <div class="w-10 h-10 rounded-full bg-primary-light flex items-center justify-center mr-3">
                                    <i class="fas fa-clock text-primary"></i>
                                </div>
                                <div>
                                    <p class="text-gray-700 font-medium">Working Hours:</p>
                                    <p class="text-sm text-gray-dark">Week Days: 9 AM - 5 PM</p>
                                    <p class="text-sm text-gray-dark">Friday & Saturday: Closed</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 hover:bg-primary-light rounded-lg transition-all duration-300">
                                <div class="w-10 h-10 rounded-full bg-primary-light flex items-center justify-center mr-3">
                                    <i class="fas fa-headset text-primary"></i>
                                </div>
                                <span class="text-gray-700">Help Line: +880 9876 543210</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-b from-gray-800 to-gray-900 text-white pt-12 pb-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <!-- About -->
                <div>
                    <div class="flex items-center mb-6">
                        <div class="w-14 h-14 rounded-full bg-gradient-primary flex items-center justify-center mr-3">
                            <i class="fas fa-graduation-cap text-white text-2xl"></i>
                        </div>
                        <h4 class="text-2xl font-bold">Oxford Mission High School</h4>
                    </div>
                    <p class="text-gray-300 mb-6">
                        Committed to providing quality education and nurturing future leaders since 1995. 
                        Our mission is to create an environment of excellence in learning.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center hover:bg-primary transition-all duration-300">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center hover:bg-red-500 transition-all duration-300">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center hover:bg-blue-400 transition-all duration-300">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="text-xl font-bold mb-6 text-primary-light">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="#home" class="text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-chevron-right text-xs"></i>Home</a></li>
                        <li><a href="#admission" class="text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-chevron-right text-xs"></i>Admission Procedure</a></li>
                        <li><a href="#academic" class="text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-chevron-right text-xs"></i>Academic Calendar</a></li>
                        <li><a href="#gallery" class="text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-chevron-right text-xs"></i>Photo Gallery</a></li>
                        <li><a href="#contact" class="text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-chevron-right text-xs"></i>Contact Us</a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h4 class="text-xl font-bold mb-6 text-primary-light">Contact Us</h4>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <i class="fas fa-map-marker-alt text-primary mt-1 mr-3"></i>
                            <span class="text-gray-300">123 Education Road, Academic Zone, Oxford City</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-envelope text-primary mr-3"></i>
                            <span class="text-gray-300">oxfordmissionhighschoolb@gmail.com</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-phone text-primary mr-3"></i>
                            <span class="text-gray-300">+880 1234 567890</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-6 text-center text-gray-400">
                <p>&copy; 2023 Oxford Mission High School. All rights reserved.</p>
                <p class="mt-2 text-sm">Designed with modern education in mind</p>
            </div>
        </div>
    </footer>

    <!-- MODALS -->

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800">Welcome Back</h3>
                        <p class="text-gray-dark mt-1">Login to access all features</p>
                    </div>
                    <button onclick="closeModal('login-modal')" 
                            class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 hover:text-gray-700 transition-all duration-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <!-- Login Form -->
                <div id="login-form-section">
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Email Address</label>
                            <input type="email" id="login-email" required 
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-gray-700 font-medium">Password</label>
                                <a href="#" class="text-sm text-primary hover:text-primary-dark">Forgot password?</a>
                            </div>
                            <input type="password" id="login-password" required 
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                        </div>
                        <button type="submit" id="login-submit" 
                                class="w-full bg-gradient-facebook text-white p-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <span id="login-text">Login to Account</span>
                            <span id="login-loading" class="hidden">
                                <i class="fas fa-spinner fa-spin mr-2"></i>Logging in...
                            </span>
                        </button>
                    </form>
                    
                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-4 bg-white text-gray-dark">Or continue with</span>
                        </div>
                    </div>
                    
                    <p class="text-center text-gray-dark">
                        Don't have an account? 
                        <button onclick="showSignupForm()" class="text-primary font-semibold hover:text-primary-dark transition-all duration-300">
                            Create New Account
                        </button>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signup-form-section" class="hidden">
                    <form id="signup-form" class="space-y-6">
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Full Name</label>
                            <input type="text" id="signup-name" required 
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium">Class</label>
                                <select id="signup-class" required 
                                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                                    <option value="">Select Class</option>
                                    <option value="6">Class 6</option>
                                    <option value="7">Class 7</option>
                                    <option value="8">Class 8</option>
                                    <option value="9">Class 9</option>
                                    <option value="10">Class 10</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium">Roll</label>
                                <input type="number" id="signup-roll" required min="1"
                                       class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Email Address</label>
                            <input type="email" id="signup-email" required 
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Password</label>
                            <input type="password" id="signup-password" required minlength="6"
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                            <div class="password-strength" id="password-strength"></div>
                            <div id="password-error" class="error-message hidden">
                                <i class="fas fa-exclamation-circle"></i>
                                <span>Password must be at least 6 characters</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Confirm Password</label>
                            <input type="password" id="signup-confirm-password" required 
                                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                            <div id="confirm-password-error" class="error-message hidden">
                                <i class="fas fa-exclamation-circle"></i>
                                <span>Passwords do not match</span>
                            </div>
                        </div>
                        <div class="text-sm text-gray-dark">
                            <p class="mb-2"><i class="fas fa-info-circle mr-2"></i>Note: Your class will automatically upgrade on 1st January each year.</p>
                            <p>Current Academic Year: <span class="font-semibold">2026-2027</span></p>
                        </div>
                        <button type="submit" id="signup-submit" 
                                class="w-full bg-gradient-green text-white p-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <span id="signup-text">Create Account</span>
                            <span id="signup-loading" class="hidden">
                                <i class="fas fa-spinner fa-spin mr-2"></i>Creating account...
                            </span>
                        </button>
                    </form>
                    
                    <p class="text-center text-gray-dark mt-6">
                        Already have an account? 
                        <button onclick="showLoginForm()" class="text-primary font-semibold hover:text-primary-dark transition-all duration-300">
                            Login Here
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                            <i class="fas fa-crown text-admin-gold"></i>
                            Admin Login
                        </h3>
                        <p class="text-gray-dark mt-1">Access administrative features</p>
                    </div>
                    <button onclick="closeModal('admin-login-modal')" 
                            class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 hover:text-gray-700 transition-all duration-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <form id="admin-login-form" class="space-y-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Email Address</label>
                        <input type="email" id="admin-email" required 
                               class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300"
                               placeholder="oxfordmissionhighschoolb@gmail.com">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Password</label>
                        <input type="password" id="admin-password" required 
                               class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300"
                               placeholder="omshhibsnimdasing">
                    </div>
                    <button type="submit" id="admin-login-submit" 
                            class="w-full bg-gradient-gold text-gray-800 p-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        <span id="admin-login-text">Login as Admin</span>
                        <span id="admin-login-loading" class="hidden">
                            <i class="fas fa-spinner fa-spin mr-2"></i>Logging in...
                        </span>
                    </button>
                </form>
                
                <p class="text-center text-gray-dark mt-6">
                    <button onclick="closeModal('admin-login-modal'); showModal('login-modal')" 
                            class="text-primary font-semibold hover:text-primary-dark transition-all duration-300">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Regular Login
                    </button>
                </p>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">My Profile</h3>
                    <button onclick="closeModal('profile-modal')" 
                            class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 hover:text-gray-700 transition-all duration-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <form id="profile-form" class="space-y-6">
                    <div class="flex flex-col items-center">
                        <div id="profile-pic-preview" 
                             class="w-32 h-32 rounded-full bg-gradient-primary flex items-center justify-center border-4 border-white shadow-lg mb-4 cursor-pointer hover:shadow-xl transition-all duration-300 profile-border"
                             onclick="document.getElementById('profile-picture').click()">
                            <span class="text-4xl text-white font-bold" id="profile-initial">U</span>
                        </div>
                        <input type="file" id="profile-picture" accept="image/*" class="hidden">
                        <p class="text-sm text-gray-dark mt-2">Click to change profile picture</p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Bio</label>
                        <textarea id="profile-bio" rows="3" 
                                  class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none resize-none transition-all duration-300"
                                  placeholder="Tell us about yourself..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Class</label>
                            <div class="p-3 bg-gray-50 rounded-lg text-gray-800 font-medium">
                                <span id="profile-class-display">N/A</span>
                                <span class="class-update ml-2">Auto-updates Jan 1</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">Roll</label>
                            <input type="text" id="profile-roll" disabled
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none transition-all duration-300 bg-gray-50">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Phone Number</label>
                        <input type="tel" id="profile-phone" 
                               class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">Address</label>
                        <input type="text" id="profile-address" 
                               class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none transition-all duration-300">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 pt-4">
                        <button type="submit" 
                                class="bg-gradient-facebook text-white p-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300">
                            Save Changes
                        </button>
                        <button type="button" onclick="closeModal('profile-modal')" 
                                class="bg-gray-200 text-gray-700 p-4 rounded-xl font-semibold hover:bg-gray-300 transition-all duration-300">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="modal">
        <div class="modal-content">
            <!-- User profile will be loaded here -->
        </div>
    </div>

    <!-- Firebase Configuration and Main JavaScript -->
    <script>
        // Firebase configuration - UPDATED with your new config
        const firebaseConfig = {
            apiKey: "AIzaSyD1mcobRC31M-UQiKVWYFNBX1Z-WyuOrNc",
            authDomain: "oxford-mission-high-school.firebaseapp.com",
            projectId: "oxford-mission-high-school",
            storageBucket: "oxford-mission-high-school.firebasestorage.app",
            messagingSenderId: "789925042490",
            appId: "1:789925042490:web:59e4ff3fdf979f7ee15803",
            measurementId: "G-LZYW3XZH4L"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Store authentication state
        let currentUser = null;
        let userData = null;
        let isLoggingIn = false;
        let isAdminUser = false;

        // Admin credentials
        const ADMIN_EMAIL = "oxfordmissionhighschoolb@gmail.com";
        const ADMIN_PASSWORD = "omshhibsnimdasing";

        // Real-time visitor counter variables
        let visitorToday = 0;
        let visitorTotal = 0;
        let visitorSessionId = null;
        let hasCountedToday = false;

        // Password strength checker
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('password-strength');
            const errorDiv = document.getElementById('password-error');
            
            if (!password) {
                strengthBar.className = 'password-strength';
                strengthBar.style.width = '0%';
                errorDiv.classList.add('hidden');
                return;
            }
            
            if (password.length < 6) {
                strengthBar.className = 'password-strength strength-weak';
                errorDiv.classList.remove('hidden');
                return 'weak';
            }
            
            errorDiv.classList.add('hidden');
            
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            switch(strength) {
                case 0:
                case 1:
                    strengthBar.className = 'password-strength strength-fair';
                    return 'fair';
                case 2:
                    strengthBar.className = 'password-strength strength-good';
                    return 'good';
                case 3:
                case 4:
                    strengthBar.className = 'password-strength strength-strong';
                    return 'strong';
            }
        }

        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Get today's date string
        function getTodayDateString() {
            const today = new Date();
            return today.toISOString().split('T')[0]; // Returns YYYY-MM-DD
        }

        // Initialize real-time visitor counter
        async function initializeVisitorCounter() {
            try {
                // Generate session ID
                visitorSessionId = generateSessionId();
                
                // Check if session already counted today
                const today = getTodayDateString();
                const sessionKey = 'visitor_session_' + today;
                const storedSession = localStorage.getItem(sessionKey);
                
                if (!storedSession) {
                    // This is a new visitor for today
                    hasCountedToday = false;
                } else {
                    hasCountedToday = true;
                }
                
                // Get visitor stats from Firestore
                const statsRef = db.collection('visitorStats').doc('counter');
                const statsDoc = await statsRef.get();
                
                if (statsDoc.exists) {
                    const data = statsDoc.data();
                    visitorToday = data.today || 0;
                    visitorTotal = data.total || 0;
                } else {
                    // Initialize if not exists
                    await statsRef.set({
                        today: 0,
                        total: 0,
                        lastReset: today,
                        sessions: {}
                    });
                }
                
                // Update display
                updateVisitorDisplay();
                
                // Count this visit if not already counted today
                if (!hasCountedToday) {
                    await countVisitor();
                }
                
                // Set up real-time listener for visitor count
                statsRef.onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        visitorToday = data.today || 0;
                        visitorTotal = data.total || 0;
                        updateVisitorDisplay();
                    }
                });
                
                // Check for daily reset
                checkDailyReset();
                
            } catch (error) {
                console.error('Error initializing visitor counter:', error);
            }
        }

        // Count a new visitor
        async function countVisitor() {
            try {
                const today = getTodayDateString();
                const statsRef = db.collection('visitorStats').doc('counter');
                
                // Increment counts
                await db.runTransaction(async (transaction) => {
                    const statsDoc = await transaction.get(statsRef);
                    
                    if (!statsDoc.exists) {
                        throw new Error("Visitor stats document does not exist");
                    }
                    
                    const data = statsDoc.data();
                    const newToday = (data.today || 0) + 1;
                    const newTotal = (data.total || 0) + 1;
                    
                    // Update session tracking
                    const sessions = data.sessions || {};
                    sessions[visitorSessionId] = today;
                    
                    transaction.update(statsRef, {
                        today: newToday,
                        total: newTotal,
                        sessions: sessions
                    });
                    
                    visitorToday = newToday;
                    visitorTotal = newTotal;
                    
                    // Mark as counted in localStorage
                    localStorage.setItem('visitor_session_' + today, visitorSessionId);
                    hasCountedToday = true;
                });
                
                updateVisitorDisplay();
                
            } catch (error) {
                console.error('Error counting visitor:', error);
            }
        }

        // Check for daily reset
        async function checkDailyReset() {
            try {
                const today = getTodayDateString();
                const statsRef = db.collection('visitorStats').doc('counter');
                
                const statsDoc = await statsRef.get();
                if (statsDoc.exists) {
                    const data = statsDoc.data();
                    const lastReset = data.lastReset;
                    
                    if (lastReset !== today) {
                        // Reset today's count and clean old sessions
                        await statsRef.update({
                            today: 0,
                            lastReset: today,
                            // Keep sessions object but we'll clean old entries
                        });
                        
                        // Clear yesterday's session from localStorage
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toISOString().split('T')[0];
                        localStorage.removeItem('visitor_session_' + yesterdayStr);
                        
                        hasCountedToday = false;
                        visitorToday = 0;
                        updateVisitorDisplay();
                    }
                }
            } catch (error) {
                console.error('Error checking daily reset:', error);
            }
        }

        // Update visitor display
        function updateVisitorDisplay() {
            document.getElementById('visitor-today').textContent = visitorToday;
            document.getElementById('visitor-total').textContent = visitorTotal.toLocaleString();
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                
                // Check if this is an admin user
                if (user.email === ADMIN_EMAIL) {
                    isAdminUser = true;
                    showSuccessPopup("Welcome Admin!", "success");
                } else {
                    isAdminUser = false;
                }
                
                // Load user data from Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    updateUserDisplay();
                    loadCommunityPosts();
                    loadNotices();
                    
                    // Only show success popup if we just logged in
                    if (isLoggingIn) {
                        showSuccessPopup("Login Successful!", "success");
                        isLoggingIn = false;
                    }
                } else if (user.email === ADMIN_EMAIL) {
                    // Create admin user document if not exists
                    userData = {
                        name: "School Admin",
                        isAdmin: true,
                        email: ADMIN_EMAIL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    await db.collection('users').doc(user.uid).set(userData);
                    updateUserDisplay();
                    showSuccessPopup("Admin login successful!", "success");
                }
            } else {
                currentUser = null;
                userData = null;
                isLoggingIn = false;
                isAdminUser = false;
                updateUserDisplay();
                document.getElementById('community-posts').innerHTML = `
                    <div class="text-center py-12 text-gray-dark">
                        <div class="w-20 h-20 rounded-full bg-primary-light flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-users text-primary text-3xl"></i>
                        </div>
                        <h4 class="text-xl font-semibold mb-2">Welcome to School Community</h4>
                        <p class="mb-6">Login to view and participate in the community</p>
                        <button onclick="showModal('login-modal')" 
                                class="bg-gradient-facebook text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all duration-300">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login to Continue
                        </button>
                    </div>
                `;
            }
        });

        // Show success popup
        function showSuccessPopup(message, type = "success") {
            const container = document.getElementById('success-popup-container');
            const popup = document.createElement('div');
            popup.className = 'success-popup';
            
            let icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'info') icon = 'info-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            popup.innerHTML = `
                <i class="fas fa-${icon} text-xl"></i>
                <span class="font-semibold">${message}</span>
            `;
            
            container.appendChild(popup);
            
            setTimeout(() => {
                popup.remove();
            }, 2000);
        }

        // Update user display in header with circular border
        function updateUserDisplay() {
            const userDisplay = document.getElementById('user-display');
            const mobileLoginBtn = document.getElementById('mobile-login-btn');
            const loginBtn = document.getElementById('login-btn');
            const adminLoginBtnContainer = document.getElementById('admin-login-btn-container');
            
            if (currentUser && userData) {
                if (isAdminUser) {
                    // Admin display with gold border
                    userDisplay.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-3 cursor-pointer group" onclick="openProfileModal()">
                                <div class="w-10 h-10 rounded-full bg-gradient-gold flex items-center justify-center shadow-md group-hover:shadow-lg transition-all duration-300 admin-border">
                                    ${userData.profilePicture ? 
                                        `<img src="${userData.profilePicture}" alt="Profile" class="w-full h-full rounded-full object-cover">` :
                                        `<span class="text-gray-800 font-bold"><i class="fas fa-crown"></i></span>`
                                    }
                                </div>
                                <div class="hidden md:block">
                                    <p class="font-semibold text-white flex items-center gap-1">
                                        ${userData.name || 'Admin'}
                                        <span class="admin-badge text-xs px-2 py-1 rounded-full">Admin</span>
                                    </p>
                                    <p class="text-xs text-white/80">School Administrator</p>
                                </div>
                            </div>
                            <button onclick="logout()" 
                                    class="hidden md:block bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300">
                                Logout
                            </button>
                        </div>
                    `;
                    
                    // Show admin-specific post section
                    document.getElementById('post-section').classList.remove('hidden');
                    document.getElementById('post-form').innerHTML = `
                        <div>
                            <textarea id="post-content" placeholder="Create an official school announcement..." 
                                      class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-primary focus:outline-none resize-none shadow-sm" 
                                      rows="3"></textarea>
                            <p id="char-count" class="text-right text-sm text-gray-dark mt-1">0/500</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex gap-4">
                                <label for="post-image" class="cursor-pointer text-gray-dark hover:text-primary transition-all duration-300 flex items-center gap-2">
                                    <i class="fas fa-image text-lg"></i>
                                    <span>Add Photo</span>
                                </label>
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" id="is-notice" class="rounded">
                                    <label for="is-notice" class="text-sm text-gray-dark">Post to Notice Board</label>
                                </div>
                            </div>
                            <button type="submit" id="post-submit" 
                                    class="bg-gradient-gold text-gray-800 px-8 py-2 rounded-lg font-semibold hover:shadow-lg transition-all duration-300">
                                <i class="fas fa-bullhorn mr-2"></i>Post Announcement
                            </button>
                        </div>
                        <div id="image-preview" class="hidden mt-4">
                            <div class="relative inline-block">
                                <img id="preview-img" class="max-w-xs rounded-lg shadow-md" />
                                <button type="button" onclick="removeImage()" 
                                        class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-red-600 transition-all duration-300">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // Regular user display with blue border
                    userDisplay.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-3 cursor-pointer group" onclick="openProfileModal()">
                                <div class="w-10 h-10 rounded-full bg-gradient-primary flex items-center justify-center shadow-md group-hover:shadow-lg transition-all duration-300 profile-border">
                                    ${userData.profilePicture ? 
                                        `<img src="${userData.profilePicture}" alt="Profile" class="w-full h-full rounded-full object-cover">` :
                                        `<span class="text-white font-bold">${userData.name ? userData.name.charAt(0).toUpperCase() : 'U'}</span>`
                                    }
                                </div>
                                <div class="hidden md:block">
                                    <p class="font-semibold text-white">${userData.name || 'User'}</p>
                                    <p class="text-xs text-white/80">Class ${userData.displayClass || userData.class || 'N/A'}</p>
                                </div>
                            </div>
                            <button onclick="logout()" 
                                    class="hidden md:block bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300">
                                Logout
                            </button>
                        </div>
                    `;
                    
                    // Show regular post section
                    document.getElementById('post-section').classList.remove('hidden');
                }
                
                loginBtn.classList.add('hidden');
                adminLoginBtnContainer.classList.add('hidden');
                
                // Update mobile login button
                mobileLoginBtn.innerHTML = `
                    <div class="nav-item text-primary" onclick="openProfileModal()">
                        <div class="w-8 h-8 rounded-full ${isAdminUser ? 'bg-gradient-gold' : 'bg-gradient-primary'} flex items-center justify-center ${isAdminUser ? 'admin-border' : 'profile-border'}">
                            ${isAdminUser ? 
                                `<i class="fas fa-crown text-gray-800 text-sm"></i>` :
                                `<span class="text-white font-bold text-sm">${userData.name ? userData.name.charAt(0).toUpperCase() : 'U'}</span>`
                            }
                        </div>
                        <span class="text-xs mt-1">Profile</span>
                    </div>
                `;
            } else {
                userDisplay.innerHTML = '';
                loginBtn.classList.remove('hidden');
                adminLoginBtnContainer.classList.remove('hidden');
                mobileLoginBtn.innerHTML = `
                    <div class="nav-item text-primary" onclick="showModal('login-modal')">
                        <i class="fas fa-sign-in-alt text-lg"></i>
                        <span class="text-xs mt-1">Login</span>
                    </div>
                `;
                document.getElementById('post-section').classList.add('hidden');
            }
        }

        // Calculate current class based on enrollment year
        function calculateCurrentClass(originalClass, enrollmentYear) {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();
            
            // If it's January 1st or later, increase class
            const yearAdjustment = currentMonth >= 0 ? currentYear - enrollmentYear : currentYear - enrollmentYear - 1;
            
            let calculatedClass = parseInt(originalClass) + yearAdjustment;
            
            // Cap at class 10
            if (calculatedClass > 10) calculatedClass = 10;
            
            return calculatedClass;
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function showSignupForm() {
            document.getElementById('login-form-section').classList.add('hidden');
            document.getElementById('signup-form-section').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('signup-form-section').classList.add('hidden');
            document.getElementById('login-form-section').classList.remove('hidden');
        }

        function showAdminLoginModal() {
            closeModal('login-modal');
            showModal('admin-login-modal');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Mobile scroll function
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                window.scrollTo({
                    top: section.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        // Toggle teachers view
        let teachersExpanded = false;
        const otherTeachers = [
            {name: "Mr. Robert Brown", subject: "Mathematics", exp: "15 years"},
            {name: "Ms. Emily Davis", subject: "English Literature", exp: "12 years"},
            {name: "Mrs. Lisa Wilson", subject: "Chemistry", exp: "10 years"},
            {name: "Mr. Michael Taylor", subject: "Biology", exp: "14 years"},
            {name: "Ms. Amanda Clark", subject: "History", exp: "8 years"},
            {name: "Mr. David Martinez", subject: "Physics", exp: "16 years"}
        ];

        function toggleTeachers() {
            const container = document.getElementById('other-teachers');
            const button = document.getElementById('see-more-teachers');
            
            if (!teachersExpanded) {
                container.classList.remove('hidden');
                container.innerHTML = '';
                otherTeachers.forEach(teacher => {
                    container.innerHTML += `
                        <div class="bg-gradient-card rounded-xl shadow-soft p-4 text-center hover-lift">
                            <div class="w-16 h-16 rounded-full bg-gradient-primary flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">${teacher.name}</h4>
                            <p class="text-primary text-sm font-medium">${teacher.subject}</p>
                            <p class="text-gray-dark text-xs mt-1">${teacher.exp} experience</p>
                        </div>
                    `;
                });
                button.innerHTML = '<i class="fas fa-minus mr-2"></i>Show Less';
                teachersExpanded = true;
            } else {
                container.classList.add('hidden');
                button.innerHTML = '<i class="fas fa-plus mr-2"></i>See More Teachers';
                teachersExpanded = false;
            }
        }

        // Password validation
        document.getElementById('signup-password').addEventListener('input', function(e) {
            checkPasswordStrength(e.target.value);
            
            // Check password confirmation
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            const confirmError = document.getElementById('confirm-password-error');
            
            if (confirmPassword && e.target.value !== confirmPassword) {
                confirmError.classList.remove('hidden');
            } else {
                confirmError.classList.add('hidden');
            }
        });

        document.getElementById('signup-confirm-password').addEventListener('input', function(e) {
            const password = document.getElementById('signup-password').value;
            const confirmError = document.getElementById('confirm-password-error');
            
            if (password && e.target.value !== password) {
                confirmError.classList.remove('hidden');
            } else {
                confirmError.classList.add('hidden');
            }
        });

        // Search functionality
        let searchTimeout;
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const query = searchInput.value.trim().toLowerCase();
                if (query.length < 2) {
                    searchResults.classList.add('hidden');
                    return;
                }
                
                try {
                    const usersSnapshot = await db.collection('users').get();
                    const results = [];
                    usersSnapshot.forEach(doc => {
                        const user = doc.data();
                        if (user.name && user.name.toLowerCase().includes(query) && !user.isAdmin) {
                            results.push({id: doc.id, ...user});
                        }
                    });
                    
                    displaySearchResults(results);
                } catch (error) {
                    console.error('Search error:', error);
                }
            }, 300);
        });

        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<p class="p-4 text-gray-dark text-center">No students found</p>';
                searchResults.classList.remove('hidden');
                return;
            }
            
            let html = '';
            results.forEach(user => {
                html += `
                    <div class="p-4 border-b border-gray-200 last:border-b-0 hover:bg-primary-light cursor-pointer transition-all duration-300" 
                         onclick="viewUserProfile('${user.id}')">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-gradient-primary flex items-center justify-center mr-3 profile-border">
                                ${user.profilePicture ? 
                                    `<img src="${user.profilePicture}" alt="Profile" class="w-full h-full rounded-full object-cover">` :
                                    `<span class="text-white font-bold">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</span>`
                                }
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${user.name || 'Unknown User'}</p>
                                <p class="text-sm text-gray-dark">Class: ${user.displayClass || user.class || 'N/A'}, Roll: ${user.roll || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            searchResults.innerHTML = html;
            searchResults.classList.remove('hidden');
        }

        // View user profile
        async function viewUserProfile(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    const modalContent = document.querySelector('#user-profile-modal .modal-content');
                    
                    // Check if current user is following this user
                    let isFollowing = false;
                    if (currentUser) {
                        const followDoc = await db.collection('followers')
                            .where('followerId', '==', currentUser.uid)
                            .where('followingId', '==', userId)
                            .limit(1)
                            .get();
                        isFollowing = !followDoc.empty;
                    }
                    
                    modalContent.innerHTML = `
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Student Profile</h3>
                                <button onclick="closeModal('user-profile-modal')" 
                                        class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 hover:text-gray-700 transition-all duration-300">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            
                            <div class="text-center mb-6">
                                <div class="w-32 h-32 rounded-full bg-gradient-primary flex items-center justify-center mx-auto mb-4 shadow-lg profile-border">
                                    ${user.profilePicture ? 
                                        `<img src="${user.profilePicture}" alt="Profile" class="w-full h-full rounded-full object-cover">` :
                                        `<span class="text-white text-5xl font-bold">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</span>`
                                    }
                                </div>
                                <h4 class="text-2xl font-bold text-gray-800">${user.name || 'Unknown User'}</h4>
                                <p class="text-gray-dark">Class ${user.displayClass || user.class || 'N/A'}, Roll ${user.roll || 'N/A'}</p>
                            </div>
                            
                            <div class="space-y-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 mb-1 font-medium">Bio</label>
                                    <p class="text-gray-800 bg-gray-50 p-4 rounded-xl">${user.bio || 'No bio provided'}</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-gray-700 mb-1 font-medium">Phone</label>
                                        <p class="text-gray-800 p-3 bg-gray-50 rounded-lg">${user.phone || 'Not provided'}</p>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-1 font-medium">Email</label>
                                        <p class="text-gray-800 p-3 bg-gray-50 rounded-lg">${user.email || 'Not provided'}</p>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1 font-medium">Address</label>
                                    <p class="text-gray-800 p-3 bg-gray-50 rounded-lg">${user.address || 'Not provided'}</p>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1 font-medium">Enrollment Year</label>
                                    <p class="text-gray-800 p-3 bg-gray-50 rounded-lg">${user.enrollmentYear || 'Not specified'}</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center py-4 border-t border-gray-200">
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-primary">${user.followerCount || 0}</p>
                                    <p class="text-gray-dark text-sm">Followers</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-primary">${user.followingCount || 0}</p>
                                    <p class="text-gray-dark text-sm">Following</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-primary">${user.postCount || 0}</p>
                                    <p class="text-gray-dark text-sm">Posts</p>
                                </div>
                            </div>
                            
                            ${currentUser && currentUser.uid !== userId ? `
                                <div class="mt-6">
                                    <button onclick="${isFollowing ? `unfollowUser('${userId}')` : `followUser('${userId}')`}" 
                                            class="w-full ${isFollowing ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gradient-facebook text-white hover:shadow-lg'} 
                                                   p-4 rounded-xl font-semibold transition-all duration-300 follow-btn">
                                        ${isFollowing ? '<i class="fas fa-check mr-2"></i>Following' : '<i class="fas fa-user-plus mr-2"></i>Follow'}
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    searchResults.classList.add('hidden');
                    searchInput.value = '';
                    showModal('user-profile-modal');
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                showSuccessPopup('Error loading profile. Please try again.', 'error');
            }
        }

        // Follow user function
        async function followUser(userId) {
            if (!currentUser) {
                showSuccessPopup('Please login to follow users', 'warning');
                return;
            }
            
            try {
                // Check if already following
                const existingFollow = await db.collection('followers')
                    .where('followerId', '==', currentUser.uid)
                    .where('followingId', '==', userId)
                    .limit(1)
                    .get();
                
                if (!existingFollow.empty) {
                    showSuccessPopup('You are already following this user', 'info');
                    return;
                }
                
                // Create follow relationship
                await db.collection('followers').add({
                    followerId: currentUser.uid,
                    followingId: userId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update follower count for followed user
                await db.collection('users').doc(userId).update({
                    followerCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update following count for current user
                await db.collection('users').doc(currentUser.uid).update({
                    followingCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Refresh user data
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                userData = userDoc.data();
                updateUserDisplay();
                
                // Update the profile modal if open
                const modal = document.getElementById('user-profile-modal');
                if (modal.style.display === 'block') {
                    viewUserProfile(userId);
                }
                
                showSuccessPopup('You are now following this user!');
            } catch (error) {
                console.error('Error following user:', error);
                showSuccessPopup('Error following user. Please try again.', 'error');
            }
        }

        // Unfollow user function
        async function unfollowUser(userId) {
            if (!currentUser) return;
            
            try {
                // Find and delete the follow relationship
                const followQuery = await db.collection('followers')
                    .where('followerId', '==', currentUser.uid)
                    .where('followingId', '==', userId)
                    .limit(1)
                    .get();
                
                if (!followQuery.empty) {
                    await followQuery.docs[0].ref.delete();
                    
                    // Update follower count
                    await db.collection('users').doc(userId).update({
                        followerCount: firebase.firestore.FieldValue.increment(-1)
                    });
                    
                    // Update following count for current user
                    await db.collection('users').doc(currentUser.uid).update({
                        followingCount: firebase.firestore.FieldValue.increment(-1)
                    });
                    
                    // Refresh user data
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    userData = userDoc.data();
                    updateUserDisplay();
                    
                    // Update the profile modal if open
                    const modal = document.getElementById('user-profile-modal');
                    if (modal.style.display === 'block') {
                        viewUserProfile(userId);
                    }
                    
                    showSuccessPopup('You have unfollowed this user');
                }
            } catch (error) {
                console.error('Error unfollowing user:', error);
                showSuccessPopup('Error unfollowing user. Please try again.', 'error');
            }
        }

        // Post creation with daily limit
        const postContent = document.getElementById('post-content');
        const charCount = document.getElementById('char-count');
        const postImage = document.getElementById('post-image');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const postForm = document.getElementById('post-form');
        
        postContent.addEventListener('input', () => {
            const length = postContent.value.length;
            charCount.textContent = `${length}/500`;
            if (length > 500) {
                charCount.classList.add('text-red-600');
            } else {
                charCount.classList.remove('text-red-600');
            }
        });

        postImage.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImg.src = event.target.result;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        function removeImage() {
            postImage.value = '';
            imagePreview.classList.add('hidden');
        }

        async function checkDailyPostLimit() {
            if (!currentUser || isAdminUser) return true;
            
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const postsSnapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('timestamp', '>=', today)
                    .get();
                
                const postCount = postsSnapshot.size;
                document.getElementById('daily-post-count').textContent = postCount;
                
                return postCount < 5;
            } catch (error) {
                console.error('Error checking post limit:', error);
                return false;
            }
        }

        postForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                showSuccessPopup('Please login to create posts', 'warning');
                return;
            }
            
            const content = postContent.value.trim();
            if (!content && !postImage.files[0]) {
                showSuccessPopup('Please add some content or an image to your post', 'warning');
                return;
            }
            
            // Check daily post limit for regular users
            if (!isAdminUser) {
                const canPost = await checkDailyPostLimit();
                if (!canPost) {
                    showSuccessPopup('You have reached your daily post limit (5 posts per day)', 'warning');
                    return;
                }
            }
            
            const submitBtn = document.getElementById('post-submit');
            submitBtn.disabled = true;
            submitBtn.innerHTML = isAdminUser ? 
                '<i class="fas fa-spinner fa-spin mr-2"></i>Posting Announcement...' :
                '<i class="fas fa-spinner fa-spin mr-2"></i>Posting...';
            
            try {
                let imageUrl = '';
                
                // Upload image if present
                if (postImage.files[0]) {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`posts/${currentUser.uid}/${Date.now()}_${postImage.files[0].name}`);
                    await fileRef.put(postImage.files[0]);
                    imageUrl = await fileRef.getDownloadURL();
                }
                
                // Create post document
                await db.collection('posts').add({
                    userId: currentUser.uid,
                    userName: userData.name,
                    userClass: userData.displayClass || userData.class,
                    userRoll: userData.roll,
                    content: content,
                    imageUrl: imageUrl,
                    likes: 0,
                    likedBy: [],
                    isAdmin: isAdminUser,
                    isNotice: isAdminUser && document.getElementById('is-notice')?.checked || false,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // If admin post and marked as notice, add to notices
                if (isAdminUser && document.getElementById('is-notice')?.checked) {
                    await db.collection('notices').add({
                        title: content.length > 50 ? content.substring(0, 50) + '...' : content,
                        content: content,
                        postedBy: userData.name,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        date: new Date().toLocaleDateString('en-GB')
                    });
                }
                
                // Update user's post count for regular users
                if (!isAdminUser) {
                    await db.collection('users').doc(currentUser.uid).update({
                        postCount: firebase.firestore.FieldValue.increment(1)
                    });
                }
                
                // Reset form
                postContent.value = '';
                postImage.value = '';
                imagePreview.classList.add('hidden');
                charCount.textContent = '0/500';
                if (document.getElementById('is-notice')) {
                    document.getElementById('is-notice').checked = false;
                }
                
                // Refresh posts
                loadCommunityPosts();
                loadNotices();
                
                // Update daily post count
                checkDailyPostLimit();
                
                showSuccessPopup(isAdminUser ? 'Announcement posted successfully!' : 'Post created successfully!');
            } catch (error) {
                console.error('Error creating post:', error);
                showSuccessPopup('Error creating post. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = isAdminUser ? 
                    '<i class="fas fa-bullhorn mr-2"></i>Post Announcement' :
                    'Post';
            }
        });

        // Load community posts
        async function loadCommunityPosts() {
            if (!currentUser) return;
            
            const postsContainer = document.getElementById('community-posts');
            postsContainer.innerHTML = '<div class="text-center py-8"><div class="loader mx-auto mb-4"></div><p class="text-gray-dark">Loading posts...</p></div>';
            
            try {
                const postsSnapshot = await db.collection('posts')
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();
                
                if (postsSnapshot.empty) {
                    postsContainer.innerHTML = '<div class="text-center py-12 text-gray-dark"><i class="fas fa-comments text-4xl mb-4 text-gray-300"></i><p class="text-xl font-semibold mb-2">No posts yet</p><p>Be the first to post!</p></div>';
                    return;
                }
                
                let postsHtml = '';
                
                for (const doc of postsSnapshot.docs) {
                    const post = doc.data();
                    const postId = doc.id;
                    
                    // Check if current user liked this post
                    let userLiked = false;
                    if (post.likedBy && Array.isArray(post.likedBy)) {
                        userLiked = post.likedBy.includes(currentUser.uid);
                    }
                    
                    // Format timestamp
                    const timestamp = post.timestamp ? post.timestamp.toDate() : new Date();
                    const timeAgo = getTimeAgo(timestamp);
                    
                    postsHtml += `
                        <div class="bg-gradient-card rounded-xl shadow-soft post-card overflow-hidden">
                            ${post.isAdmin ? `
                                <div class="admin-badge py-3 px-4 flex items-center justify-center gap-2">
                                    <i class="fas fa-certificate"></i>
                                    <span>Official School ${post.isNotice ? 'Notice' : 'Post'}</span>
                                </div>
                            ` : ''}
                            <div class="p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 rounded-full ${post.isAdmin ? 'bg-gradient-gold admin-border' : 'bg-gradient-primary profile-border'} flex items-center justify-center mr-3">
                                        ${post.isAdmin ? 
                                            `<i class="fas fa-crown ${post.isAdmin ? 'text-gray-800' : 'text-white'}"></i>` :
                                            `<span class="text-white font-bold">${post.userName ? post.userName.charAt(0).toUpperCase() : 'U'}</span>`
                                        }
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800 flex items-center gap-2">
                                            ${post.userName || 'Unknown User'}
                                            ${post.isAdmin ? '<span class="admin-badge text-xs px-2 py-1 rounded-full">Admin</span>' : ''}
                                        </p>
                                        <p class="text-sm text-gray-dark">${post.userClass ? 'Class ' + post.userClass : ''}${post.userRoll ? ', Roll ' + post.userRoll : ''}  ${timeAgo}</p>
                                    </div>
                                </div>
                                
                                ${post.content ? `<p class="text-gray-800 mb-4">${post.content}</p>` : ''}
                                
                                ${post.imageUrl ? `
                                    <div class="mb-4">
                                        <img src="${post.imageUrl}" alt="Post image" class="w-full h-auto rounded-xl max-h-96 object-cover shadow-md">
                                    </div>
                                ` : ''}
                                
                                <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                                    <button onclick="likePost('${postId}', ${post.likes || 0})" 
                                            class="flex items-center space-x-2 text-gray-dark hover:text-red-600 transition-all duration-300 like-btn ${userLiked ? 'text-red-600' : ''}">
                                        <i class="fas fa-heart ${userLiked ? 'fas' : 'far'} text-lg"></i>
                                        <span class="font-medium">${post.likes || 0} Likes</span>
                                    </button>
                                    <div class="text-sm text-gray-dark">
                                        <i class="fas fa-eye mr-1"></i> ${Math.floor((post.likes || 0) * 1.5)} reach
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                postsContainer.innerHTML = postsHtml;
            } catch (error) {
                console.error('Error loading posts:', error);
                postsContainer.innerHTML = '<div class="text-center py-12 text-red-500"><i class="fas fa-exclamation-triangle text-3xl mb-4"></i><p class="font-semibold">Error loading posts</p><p class="text-sm mt-1">Please try again</p></div>';
            }
        }

        // Like post function with animation
        async function likePost(postId, currentLikes) {
            if (!currentUser) {
                showSuccessPopup('Please login to like posts', 'warning');
                return;
            }
            
            try {
                const postRef = db.collection('posts').doc(postId);
                const postDoc = await postRef.get();
                
                if (!postDoc.exists) return;
                
                const post = postDoc.data();
                let likedBy = post.likedBy || [];
                if (!Array.isArray(likedBy)) likedBy = [];
                
                const userIndex = likedBy.indexOf(currentUser.uid);
                
                if (userIndex > -1) {
                    // Unlike
                    likedBy.splice(userIndex, 1);
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: likedBy
                    });
                } else {
                    // Like
                    likedBy.push(currentUser.uid);
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: likedBy
                    });
                }
                
                // Add animation to the like button
                const likeBtn = event.target.closest('.like-btn');
                if (likeBtn) {
                    likeBtn.classList.add('like-animation');
                    setTimeout(() => {
                        likeBtn.classList.remove('like-animation');
                    }, 300);
                }
                
                // Refresh posts
                loadCommunityPosts();
            } catch (error) {
                console.error('Error liking post:', error);
                showSuccessPopup('Error liking post. Please try again.', 'error');
            }
        }

        // Time ago function
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            
            return "just now";
        }

        // Load notices from Firestore
        async function loadNotices() {
            try {
                const noticesSnapshot = await db.collection('notices')
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                let noticesHtml = '';
                
                if (noticesSnapshot.empty) {
                    // Fallback to default notices
                    const defaultNotices = [
                        {date: '28-08-2025', title: 'Annual Sports Day Registration', content: 'Registration for Annual Sports Day is now open. All students are encouraged to participate.'},
                        {date: '07-08-2025', title: 'Parent-Teacher Meeting', content: 'Monthly parent-teacher meeting scheduled for August 10, 2025 at 10:00 AM in the school auditorium.'},
                        {date: '01-08-2025', title: 'Mid-term Examination Schedule', content: 'Mid-term examination schedule has been published. Please check the notice board for details.'},
                        {date: '25-07-2025', title: 'Library Week Celebration', content: 'Library week celebration from July 28 to August 3. Various competitions and activities will be organized.'}
                    ];
                    
                    defaultNotices.forEach(notice => {
                        noticesHtml += `
                            <div class="border-l-4 border-primary pl-4 py-3 hover:bg-primary-light transition-all duration-300 rounded-r-lg">
                                <p class="text-sm text-primary font-semibold">${notice.date}</p>
                                <p class="font-semibold text-gray-800 mt-1">${notice.title}</p>
                                <p class="text-sm text-gray-dark mt-1">${notice.content}</p>
                            </div>
                        `;
                    });
                } else {
                    noticesSnapshot.forEach(doc => {
                        const notice = doc.data();
                        const date = notice.date || new Date(notice.timestamp?.toDate()).toLocaleDateString('en-GB');
                        
                        noticesHtml += `
                            <div class="border-l-4 border-primary pl-4 py-3 hover:bg-primary-light transition-all duration-300 rounded-r-lg">
                                <p class="text-sm text-primary font-semibold">${date}</p>
                                <p class="font-semibold text-gray-800 mt-1">${notice.title || 'Notice'}</p>
                                <p class="text-sm text-gray-dark mt-1">${notice.content || ''}</p>
                                ${notice.postedBy ? `<p class="text-xs text-gray-500 mt-1">Posted by: ${notice.postedBy}</p>` : ''}
                            </div>
                        `;
                    });
                }
                
                document.getElementById('notice-list').innerHTML = noticesHtml;
            } catch (error) {
                console.error('Error loading notices:', error);
                // Show default notices on error
                document.getElementById('notice-list').innerHTML = `
                    <div class="border-l-4 border-primary pl-4 py-3">
                        <p class="text-sm text-primary font-semibold">01-02-2026</p>
                        <p class="font-semibold text-gray-800 mt-1">Welcome to New Academic Year</p>
                        <p class="text-sm text-gray-dark mt-1">Welcome to the 2026-2027 academic year. Classes begin from February 2, 2026.</p>
                    </div>
                `;
            }
        }

        // Authentication functions
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Prevent admin login through regular login
            if (email === ADMIN_EMAIL) {
                showSuccessPopup('Please use Admin Login button for admin access', 'warning');
                return;
            }
            
            const loginBtn = document.getElementById('login-submit');
            const loginText = document.getElementById('login-text');
            const loginLoading = document.getElementById('login-loading');
            
            loginText.classList.add('hidden');
            loginLoading.classList.remove('hidden');
            loginBtn.disabled = true;
            
            try {
                isLoggingIn = true;
                await auth.signInWithEmailAndPassword(email, password);
                closeModal('login-modal');
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            } catch (error) {
                console.error('Login error:', error);
                showSuccessPopup('Login failed: ' + error.message, 'error');
            } finally {
                loginText.classList.remove('hidden');
                loginLoading.classList.add('hidden');
                loginBtn.disabled = false;
            }
        });

        // Admin login
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            // Strict admin validation
            if (email !== ADMIN_EMAIL || password !== ADMIN_PASSWORD) {
                showSuccessPopup('Invalid admin credentials. Only specified email and password allowed.', 'error');
                return;
            }
            
            const loginBtn = document.getElementById('admin-login-submit');
            const loginText = document.getElementById('admin-login-text');
            const loginLoading = document.getElementById('admin-login-loading');
            
            loginText.classList.add('hidden');
            loginLoading.classList.remove('hidden');
            loginBtn.disabled = true;
            
            try {
                isLoggingIn = true;
                await auth.signInWithEmailAndPassword(email, password);
                closeModal('admin-login-modal');
                document.getElementById('admin-email').value = '';
                document.getElementById('admin-password').value = '';
            } catch (error) {
                console.error('Admin login error:', error);
                showSuccessPopup('Admin login failed: ' + error.message, 'error');
            } finally {
                loginText.classList.remove('hidden');
                loginLoading.classList.add('hidden');
                loginBtn.disabled = false;
            }
        });

        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value.trim();
            const studentClass = document.getElementById('signup-class').value;
            const roll = document.getElementById('signup-roll').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            
            // Validation
            if (password !== confirmPassword) {
                showSuccessPopup('Passwords do not match!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showSuccessPopup('Password must be at least 6 characters!', 'error');
                return;
            }
            
            if (!studentClass) {
                showSuccessPopup('Please select a class!', 'error');
                return;
            }
            
            if (!roll) {
                showSuccessPopup('Please enter roll number!', 'error');
                return;
            }
            
            // Prevent admin email signup
            if (email === ADMIN_EMAIL) {
                showSuccessPopup('This email is reserved for admin use only', 'error');
                return;
            }
            
            const signupBtn = document.getElementById('signup-submit');
            const signupText = document.getElementById('signup-text');
            const signupLoading = document.getElementById('signup-loading');
            
            signupText.classList.add('hidden');
            signupLoading.classList.remove('hidden');
            signupBtn.disabled = true;
            
            try {
                // Create user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                const currentYear = new Date().getFullYear();
                const enrollmentYear = currentYear;
                
                // Calculate current class based on enrollment year
                const currentMonth = new Date().getMonth();
                const displayClass = calculateCurrentClass(studentClass, enrollmentYear);
                
                // Create user document in Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    class: studentClass,
                    displayClass: displayClass,
                    roll: roll,
                    email: email,
                    enrollmentYear: enrollmentYear,
                    bio: '',
                    phone: '',
                    address: '',
                    followerCount: 0,
                    followingCount: 0,
                    postCount: 0,
                    dailyPostCount: 0,
                    lastPostReset: new Date(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showSuccessPopup('Account created successfully!', 'success');
                closeModal('login-modal');
                document.getElementById('signup-form').reset();
                
                // Auto login after signup
                isLoggingIn = true;
                await auth.signInWithEmailAndPassword(email, password);
                
            } catch (error) {
                console.error('Signup error:', error);
                
                let errorMessage = 'Signup failed. ';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage += 'Email already in use.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage += 'Password is too weak.';
                } else {
                    errorMessage += error.message;
                }
                
                showSuccessPopup(errorMessage, 'error');
            } finally {
                signupText.classList.remove('hidden');
                signupLoading.classList.add('hidden');
                signupBtn.disabled = false;
            }
        });

        function logout() {
            auth.signOut();
            closeModal('profile-modal');
            closeModal('user-profile-modal');
            showSuccessPopup('Logged out successfully!');
        }

        // Profile management
        document.getElementById('profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const bio = document.getElementById('profile-bio').value;
            const phone = document.getElementById('profile-phone').value;
            const address = document.getElementById('profile-address').value;
            
            try {
                await db.collection('users').doc(currentUser.uid).update({
                    bio: bio,
                    phone: phone,
                    address: address
                });
                
                // Update local user data
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                userData = userDoc.data();
                updateUserDisplay();
                
                showSuccessPopup('Profile updated successfully!');
                closeModal('profile-modal');
            } catch (error) {
                console.error('Error updating profile:', error);
                showSuccessPopup('Error updating profile. Please try again.', 'error');
            }
        });

        // Handle profile picture upload
        document.getElementById('profile-picture').addEventListener('change', async (e) => {
            if (!currentUser || !e.target.files[0]) return;
            
            try {
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`profile_pictures/${currentUser.uid}`);
                await fileRef.put(e.target.files[0]);
                const imageUrl = await fileRef.getDownloadURL();
                
                // Update user document with image URL
                await db.collection('users').doc(currentUser.uid).update({
                    profilePicture: imageUrl
                });
                
                // Update preview
                document.getElementById('profile-pic-preview').innerHTML = `
                    <img src="${imageUrl}" alt="Profile" class="w-full h-full rounded-full object-cover">
                `;
                
                // Update local user data
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                userData = userDoc.data();
                updateUserDisplay();
                
                showSuccessPopup('Profile picture updated!');
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                showSuccessPopup('Error uploading profile picture. Please try again.', 'error');
            }
        });

        // Initialize profile modal with user data
        async function openProfileModal() {
            if (!currentUser) {
                showSuccessPopup('Please login to access profile settings', 'warning');
                return;
            }
            
            // Reload user data to ensure it's current
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                userData = userDoc.data();
                
                // Update class display if needed
                if (userData.class && userData.enrollmentYear) {
                    const currentClass = calculateCurrentClass(userData.class, userData.enrollmentYear);
                    if (currentClass !== parseInt(userData.displayClass || userData.class)) {
                        await db.collection('users').doc(currentUser.uid).update({
                            displayClass: currentClass
                        });
                        userData.displayClass = currentClass;
                    }
                }
            }
            
            document.getElementById('profile-bio').value = userData.bio || '';
            document.getElementById('profile-phone').value = userData.phone || '';
            document.getElementById('profile-address').value = userData.address || '';
            document.getElementById('profile-roll').value = userData.roll || '';
            document.getElementById('profile-class-display').textContent = 
                userData.displayClass || userData.class || 'N/A';
            
            // Set profile initial
            document.getElementById('profile-initial').textContent = userData.name ? userData.name.charAt(0).toUpperCase() : 'U';
            
            // Load profile picture if exists
            const previewDiv = document.getElementById('profile-pic-preview');
            if (userData.profilePicture) {
                previewDiv.innerHTML = `<img src="${userData.profilePicture}" alt="Profile" class="w-full h-full rounded-full object-cover">`;
            } else {
                previewDiv.innerHTML = `<span class="text-white text-5xl font-bold">${userData.name ? userData.name.charAt(0).toUpperCase() : 'U'}</span>`;
            }
            
            showModal('profile-modal');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize visitor counter
            initializeVisitorCounter();
            
            // Load notices
            loadNotices();
            
            // Add smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
